<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="æœåœ£ä¹‹è·¯å¤©æ°”æŸ¥è¯¢å·¥å…· - æ”¯æŒ8ç§è¯­è¨€">
    <title>æœåœ£ä¹‹è·¯å¤©æ°”æŸ¥è¯¢å·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif; }
        
        /* å†å²æ•°æ®å¡ç‰‡ç‰¹æ®Šæ ·å¼ */
        .historical-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px dashed #f59e0b !important;
        }
        
        /* å®æ—¶æ•°æ®å¡ç‰‡æ ·å¼ */
        .realtime-card {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            border: 2px solid #e5e7eb;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* å¼¹çª—é®ç½© */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        /* åŸå¸‚è‡ªåŠ¨è¡¥å…¨ä¸‹æ‹‰æ¡† */
        .autocomplete-dropdown {
            position: absolute;
            z-index: 1000;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .autocomplete-item {
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .autocomplete-item:hover {
            background-color: #fef3c7;
        }
        
        .autocomplete-item.selected {
            background-color: #fde68a;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 min-h-screen">
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // AEMET APIé…ç½®
        const AEMET_API_KEY = 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ6ZXl1bjMzMDFAZ21haWwuY29tIiwianRpIjoiODRiNDc5MWEtYzg1Mi00NzNkLTk0MGQtOWFjZmZjZjYwYmE3IiwiaXNzIjoiQUVNRVQiLCJpYXQiOjE3NjY3OTM3MTYsInVzZXJJZCI6Ijg0YjQ3OTFhLWM4NTItNDczZC05NDBkLTlhY2ZmY2Y2MGJhNyIsInJvbGUiOiIifQ.LeyjcmqkmvcW4leoagn8Ev25wQAHPerCfSm-4fmwTLA';

        // æœåœ£ä¹‹è·¯åŸå¸‚åˆ—è¡¨ï¼ˆç”¨äºè‡ªåŠ¨è¡¥å…¨ï¼‰
        const CAMINO_CITIES = [
            'Santiago de Compostela',
            'Sarria',
            'PortomarÃ­n',
            'Palas de Rei',
            'ArzÃºa',
            'O Pedrouzo',
            'LeÃ³n',
            'Astorga',
            'Ponferrada',
            'O Cebreiro',
            'Triacastela',
            'Villafranca del Bierzo',
            'Burgos',
            'Pamplona',
            'LogroÃ±o',
            'Estella',
            'Santo Domingo de la Calzada',
            'NÃ¡jera',
            'Belorado',
            'FrÃ³mista',
            'CarriÃ³n de los Condes',
            'SahagÃºn',
            'Mansilla de las Mulas',
            'Porto',
            'Tui',
            'Pontevedra',
            'PadrÃ³n',
            'Bilbao',
            'Oviedo',
            'Lugo',
            'FoncebadÃ³n',
            'Roncesvalles',
            'Saint-Jean-Pied-de-Port',
            'Zubiri',
            'Puente la Reina',
            'San Juan de Ortega',
            'Hornillos del Camino',
            'Castrojeriz',
            'Terradillos de los Templarios',
            'Melide',
            'Ribadiso',
            'Pedrouzo',
            'Lavacolla'
        ].sort();

        // å¤©æ°”çŠ¶å†µç¿»è¯‘ï¼ˆè¥¿ç­ç‰™è¯­åˆ°ä¸­æ–‡åŠå…¶ä»–è¯­è¨€ï¼‰
        const weatherTranslations = {
            'zh-CN': {
                'Despejado': 'æ™´å¤©',
                'Poco nuboso': 'å°‘äº‘',
                'Parcialmente nuboso': 'å¤šäº‘',
                'Nuboso': 'é˜´å¤©',
                'Muy nuboso': 'å¯†äº‘',
                'Cubierto': 'å…¨é˜´',
                'Niebla': 'é›¾',
                'Bruma': 'è–„é›¾',
                'Lluvia ligera': 'å°é›¨',
                'Lluvia': 'ä¸­é›¨',
                'Lluvia fuerte': 'å¤§é›¨',
                'Chubascos': 'é˜µé›¨',
                'Tormentas': 'é›·æš´',
                'Nieve': 'é›ª',
                'Granizo': 'å†°é›¹',
                'N/A': 'N/A'
            },
            'en': {
                'Despejado': 'Clear',
                'Poco nuboso': 'Mostly Clear',
                'Parcialmente nuboso': 'Partly Cloudy',
                'Nuboso': 'Cloudy',
                'Muy nuboso': 'Mostly Cloudy',
                'Cubierto': 'Overcast',
                'Niebla': 'Fog',
                'Bruma': 'Mist',
                'Lluvia ligera': 'Light Rain',
                'Lluvia': 'Rain',
                'Lluvia fuerte': 'Heavy Rain',
                'Chubascos': 'Showers',
                'Tormentas': 'Thunderstorm',
                'Nieve': 'Snow',
                'Granizo': 'Hail',
                'N/A': 'N/A'
            },
            'es': {
                'Despejado': 'Despejado',
                'Poco nuboso': 'Poco nuboso',
                'Parcialmente nuboso': 'Parcialmente nuboso',
                'Nuboso': 'Nuboso',
                'Muy nuboso': 'Muy nuboso',
                'Cubierto': 'Cubierto',
                'Niebla': 'Niebla',
                'Bruma': 'Bruma',
                'Lluvia ligera': 'Lluvia ligera',
                'Lluvia': 'Lluvia',
                'Lluvia fuerte': 'Lluvia fuerte',
                'Chubascos': 'Chubascos',
                'Tormentas': 'Tormentas',
                'Nieve': 'Nieve',
                'Granizo': 'Granizo',
                'N/A': 'N/A'
            }
        };

        // å¤©æ°”å›¾æ ‡æ˜ å°„
        const getWeatherIcon = (condition) => {
            const conditionLower = condition.toLowerCase();
            if (conditionLower.includes('despejado') || conditionLower.includes('clear')) return 'â˜€ï¸';
            if (conditionLower.includes('poco nuboso') || conditionLower.includes('mostly clear')) return 'ğŸŒ¤ï¸';
            if (conditionLower.includes('parcialmente') || conditionLower.includes('partly')) return 'â›…';
            if (conditionLower.includes('nuboso') || conditionLower.includes('cloudy')) return 'â˜ï¸';
            if (conditionLower.includes('cubierto') || conditionLower.includes('overcast')) return 'â˜ï¸';
            if (conditionLower.includes('niebla') || conditionLower.includes('fog')) return 'ğŸŒ«ï¸';
            if (conditionLower.includes('bruma') || conditionLower.includes('mist')) return 'ğŸŒ«ï¸';
            if (conditionLower.includes('tormenta') || conditionLower.includes('thunder')) return 'â›ˆï¸';
            if (conditionLower.includes('lluvia fuerte') || conditionLower.includes('heavy rain')) return 'ğŸŒ§ï¸';
            if (conditionLower.includes('lluvia') || conditionLower.includes('rain')) return 'ğŸŒ¦ï¸';
            if (conditionLower.includes('chubasco') || conditionLower.includes('shower')) return 'ğŸŒ¦ï¸';
            if (conditionLower.includes('nieve') || conditionLower.includes('snow')) return 'ğŸŒ¨ï¸';
            if (conditionLower.includes('granizo') || conditionLower.includes('hail')) return 'ğŸŒ¨ï¸';
            return 'â˜ï¸';
        };

        // ç¿»è¯‘å¤©æ°”çŠ¶å†µ
        const translateWeather = (condition, language) => {
            const langCode = language.startsWith('zh') ? 'zh-CN' : (language === 'es' ? 'es' : 'en');
            const translations = weatherTranslations[langCode];
            return translations[condition] || condition;
        };

        // å¤šè¯­è¨€ç¿»è¯‘å­—å…¸
        const translations = {
            'zh-CN': {
                title: 'æœåœ£ä¹‹è·¯å¤©æ°”æŸ¥è¯¢',
                subtitle: 'ä¸ºæ‰€æœ‰æœåœ£è€…æä¾›ç²¾å‡†çš„å¤©æ°”é¢„æŠ¥æœåŠ¡ â€¢ æ”¯æŒæ‰€æœ‰è·¯çº¿ â€¢ å†å²æ•°æ®å‚è€ƒ',
                selectRoute: 'é€‰æ‹©è·¯çº¿',
                customRoute: 'âœ¨ è‡ªå®šä¹‰è·¯çº¿',
                customRouteDesc: 'åˆ›å»ºä½ çš„ä¸“å±è·¯çº¿',
                itinerary: 'è¡Œç¨‹å®‰æ’',
                days: 'å¤©',
                total: 'å…±',
                autoFillDates: 'è‡ªåŠ¨å¡«å……æ—¥æœŸ',
                addDay: 'æ·»åŠ ä¸€å¤©',
                locationPlaceholder: 'è¾“å…¥åŸé•‡åç§°ï¼ˆå¦‚ï¼šS æœç´¢ Santiagoï¼‰',
                queryWeather: 'æŸ¥è¯¢å¤©æ°”é¢„æŠ¥',
                querying: 'æ­£åœ¨æŸ¥è¯¢å¤©æ°”...',
                weatherForecast: 'å¤©æ°”é¢„æŠ¥',
                cardView: 'ğŸ“‹ è¡¨æ ¼è§†å›¾',
                tableView: 'ğŸ´ å¡ç‰‡è§†å›¾',
                copyTable: 'å¤åˆ¶è¡¨æ ¼',
                copied: 'å·²å¤åˆ¶',
                weather: 'å¤©æ°”',
                dayTemp: 'æ—¥é—´æ¸©åº¦',
                nightTemp: 'å¤œé—´æ¸©åº¦',
                feelsLike: 'ä½“æ„Ÿ',
                rainProb: 'é™é›¨æ¦‚ç‡',
                sunrise: 'æ—¥å‡º',
                sunset: 'æ—¥è½',
                usageTip: 'ğŸ’¡ ä½¿ç”¨æç¤º',
                usageTipText: 'åˆ‡æ¢"å¡ç‰‡è§†å›¾"æŸ¥çœ‹ç¾è§‚ç•Œé¢ï¼Œæˆ–"è¡¨æ ¼è§†å›¾"å¤åˆ¶æ–‡æœ¬ã€‚æ•°æ®æ¥æºï¼šAEMETå®˜æ–¹ã€‚',
                notice: 'âš ï¸ æ³¨æ„äº‹é¡¹',
                noticeText: 'å±±åŒºå¤©æ°”å˜åŒ–å¿«ï¼Œé‡æç«¯å¤©æ°”é¢„è­¦è¯·è°ƒæ•´è¡Œç¨‹ã€‚å®‰å…¨ç¬¬ä¸€ï¼',
                footerText: 'æœ¬å·¥å…·ä¸ºæœåœ£ä¹‹è·¯å¾’æ­¥è€…æä¾›ä¾¿æ·çš„å¤©æ°”æŸ¥è¯¢æœåŠ¡',
                dataSource: 'æ•°æ®æ¥æºï¼šAEMETï¼ˆè¥¿ç­ç‰™æ°”è±¡å±€ï¼‰',
                weekdays: ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'],
                dateTooFarTitle: 'æ—¥æœŸè¶…å‡ºèŒƒå›´',
                dateTooFarMessage: 'æ‚¨é€‰æ‹©çš„æ—¥æœŸè·ç¦»ç°åœ¨è¶…è¿‡1å¹´ï¼Œå»ºè®®åœ¨å‡ºå‘å‰1å¹´å†…æŸ¥è¯¢å¤©æ°”ä¿¡æ¯ä»¥è·å¾—æ›´å‡†ç¡®çš„é¢„æŠ¥æ•°æ®ã€‚',
                understand: 'æˆ‘çŸ¥é“äº†',
                historicalDataWarning: 'æç¤ºï¼šæ‚¨é€‰æ‹©çš„æ—¥æœŸè¶…å‡ºå¤©æ°”é¢„æŠ¥èŒƒå›´ï¼ˆæœ€å¤šæå‰15å¤©ï¼‰ã€‚ä»¥ä¸‹æ˜¾ç¤ºçš„æ˜¯åŸºäºå†å²æ•°æ®é¢„æµ‹çš„å‚è€ƒä¿¡æ¯ï¼Œä»…ä¾›è§„åˆ’å‚è€ƒã€‚å»ºè®®å‡ºå‘å‰2å‘¨å†æ¬¡æŸ¥è¯¢å®æ—¶å¤©æ°”é¢„æŠ¥è·å–æœ€å‡†ç¡®çš„ä¿¡æ¯ã€‚',
                historicalDataBadge: 'å†å²å¹³å‡æ•°æ®é¢„æµ‹',
                realTimeForecast: 'å®æ—¶å¤©æ°”é¢„æŠ¥',
                dataSourceLabel: 'æ•°æ®æ¥æº',
                historicalAvgSource: 'åŸºäºå†å²å¹³å‡å€¼é¢„æµ‹',
                realtimeSource: 'AEMETå®æ—¶é¢„æŠ¥',
                errorFetchingWeather: 'è·å–å¤©æ°”æ•°æ®å¤±è´¥',
                retryQuery: 'é‡è¯•',
                noRainData: 'å†å²æ•°æ®æ— é™é›¨ç‡',
                stormWarning: 'âš ï¸ æš´é›¨é¢„è­¦ (AEMET)',
                bringUmbrella: 'ğŸŒ§ï¸ è®°å¾—å¸¦é›¨å…·',
                keepWarm: 'ğŸ§¥ æ³¨æ„ä¿æš–',
                dataInfo0to15: '0-15å¤©å†…å‡ºå‘ï¼šæ˜¾ç¤ºAEMETå®æ—¶å¤©æ°”é¢„æŠ¥',
                dataInfo15to365: '15å¤©-1å¹´å†…å‡ºå‘ï¼šæ˜¾ç¤ºå†å²å¹³å‡æ•°æ®é¢„æµ‹ï¼ˆä»…ä¾›å‚è€ƒï¼‰',
                dataInfoOver1Year: 'è¶…è¿‡1å¹´ï¼šå»ºè®®åœ¨å‡ºå‘å‰1å¹´å†…æŸ¥è¯¢å¤©æ°”ä¿¡æ¯'
            },
            'en': {
                title: 'Camino Weather Tool',
                subtitle: 'Accurate weather forecasts for all pilgrims â€¢ All routes supported â€¢ Historical data',
                selectRoute: 'Select Route',
                customRoute: 'âœ¨ Custom Route',
                customRouteDesc: 'Create your own route',
                itinerary: 'Itinerary',
                days: 'days',
                total: 'Total',
                autoFillDates: 'Auto-fill Dates',
                addDay: 'Add Day',
                locationPlaceholder: 'Type city name (e.g., S for Santiago)',
                queryWeather: 'Check Weather',
                querying: 'Checking weather...',
                weatherForecast: 'Weather Forecast',
                cardView: 'ğŸ“‹ Table View',
                tableView: 'ğŸ´ Card View',
                copyTable: 'Copy Table',
                copied: 'Copied',
                weather: 'Weather',
                dayTemp: 'Day Temp',
                nightTemp: 'Night Temp',
                feelsLike: 'Feels Like',
                rainProb: 'Rain Probability',
                sunrise: 'Sunrise',
                sunset: 'Sunset',
                usageTip: 'ğŸ’¡ Usage Tip',
                usageTipText: 'Switch to "Card View" for better display. Data: AEMET official.',
                notice: 'âš ï¸ Notice',
                noticeText: 'Mountain weather changes rapidly. Adjust plan if extreme weather. Safety first!',
                footerText: 'Weather tool for Camino de Santiago pilgrims',
                dataSource: 'Data source: AEMET (Spanish Meteorological Agency)',
                weekdays: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
                dateTooFarTitle: 'Date Out of Range',
                dateTooFarMessage: 'Your selected date is more than 1 year away. Please check weather within 1 year of departure for more accurate forecast.',
                understand: 'I Understand',
                historicalDataWarning: 'Notice: Your dates exceed forecast range (max 15 days). Data shown is historical prediction for reference only. Check actual forecast 2 weeks before departure.',
                historicalDataBadge: 'Historical Prediction',
                realTimeForecast: 'Real-time Forecast',
                dataSourceLabel: 'Data Source',
                historicalAvgSource: 'Based on historical prediction',
                realtimeSource: 'AEMET real-time forecast',
                errorFetchingWeather: 'Failed to fetch weather data',
                retryQuery: 'Retry',
                noRainData: 'No rain data for historical',
                stormWarning: 'âš ï¸ Storm Warning (AEMET)',
                bringUmbrella: 'ğŸŒ§ï¸ Bring umbrella',
                keepWarm: 'ğŸ§¥ Keep warm',
                dataInfo0to15: 'Within 15 days: Real-time AEMET forecast',
                dataInfo15to365: '15 days - 1 year: Historical prediction (reference only)',
                dataInfoOver1Year: 'Beyond 1 year: Check within 1 year of departure'
            },
            'es': {
                title: 'Herramienta del Tiempo del Camino',
                subtitle: 'Previsiones meteorolÃ³gicas precisas para todos los peregrinos',
                selectRoute: 'Seleccionar Ruta',
                customRoute: 'âœ¨ Ruta Personalizada',
                customRouteDesc: 'Crea tu propia ruta',
                itinerary: 'Itinerario',
                days: 'dÃ­as',
                total: 'Total',
                autoFillDates: 'Rellenar Fechas',
                addDay: 'AÃ±adir DÃ­a',
                locationPlaceholder: 'Escribe nombre (ej: S para Santiago)',
                queryWeather: 'Consultar Tiempo',
                querying: 'Consultando...',
                weatherForecast: 'PrevisiÃ³n del Tiempo',
                cardView: 'ğŸ“‹ Vista de Tabla',
                tableView: 'ğŸ´ Vista de Tarjetas',
                copyTable: 'Copiar Tabla',
                copied: 'Copiado',
                weather: 'Tiempo',
                dayTemp: 'Temp. DÃ­a',
                nightTemp: 'Temp. Noche',
                feelsLike: 'SensaciÃ³n',
                rainProb: 'Prob. Lluvia',
                sunrise: 'Amanecer',
                sunset: 'Atardecer',
                usageTip: 'ğŸ’¡ Consejo',
                usageTipText: 'Cambia a "Vista de Tarjetas" para mejor visualizaciÃ³n. Datos: AEMET oficial.',
                notice: 'âš ï¸ Aviso',
                noticeText: 'Â¡El tiempo en montaÃ±a cambia rÃ¡pido. Seguridad primero!',
                footerText: 'Herramienta meteorolÃ³gica para peregrinos del Camino',
                dataSource: 'Fuente de datos: AEMET (Agencia Estatal de MeteorologÃ­a)',
                weekdays: ['Domingo', 'Lunes', 'Martes', 'MiÃ©rcoles', 'Jueves', 'Viernes', 'SÃ¡bado'],
                dateTooFarTitle: 'Fecha Fuera de Rango',
                dateTooFarMessage: 'La fecha seleccionada estÃ¡ a mÃ¡s de 1 aÃ±o. Consulte dentro de 1 aÃ±o antes de la salida.',
                understand: 'Entendido',
                historicalDataWarning: 'Aviso: Las fechas exceden el rango de pronÃ³stico. Datos histÃ³ricos solo para referencia.',
                historicalDataBadge: 'PredicciÃ³n HistÃ³rica',
                realTimeForecast: 'PronÃ³stico en Tiempo Real',
                dataSourceLabel: 'Fuente',
                historicalAvgSource: 'PredicciÃ³n basada en histÃ³rico',
                realtimeSource: 'PronÃ³stico AEMET en tiempo real',
                errorFetchingWeather: 'Error al obtener datos',
                retryQuery: 'Reintentar',
                noRainData: 'Sin datos de lluvia',
                stormWarning: 'âš ï¸ Alerta de Tormenta (AEMET)',
                bringUmbrella: 'ğŸŒ§ï¸ Lleva paraguas',
                keepWarm: 'ğŸ§¥ AbrÃ­gate',
                dataInfo0to15: 'Dentro de 15 dÃ­as: PronÃ³stico AEMET en tiempo real',
                dataInfo15to365: '15 dÃ­as - 1 aÃ±o: PredicciÃ³n histÃ³rica (referencia)',
                dataInfoOver1Year: 'MÃ¡s de 1 aÃ±o: Consulte dentro de 1 aÃ±o antes'
            }
        };

        // å…¶ä»–è¯­è¨€ç®€åŒ–ç‰ˆ
        translations['zh-TW'] = {...translations['zh-CN'], 
            title: 'æœè–ä¹‹è·¯å¤©æ°£æŸ¥è©¢',
            weekdays: ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­']
        };
        translations['fr'] = {...translations['en'], 
            title: 'MÃ©tÃ©o du Chemin', 
            days: 'jours',
            weekdays: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi']
        };
        translations['de'] = {...translations['en'], 
            title: 'Camino Wetter', 
            days: 'Tage',
            weekdays: ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag']
        };
        translations['pt'] = {...translations['en'], 
            title: 'Tempo do Caminho', 
            days: 'dias',
            weekdays: ['Domingo', 'Segunda', 'TerÃ§a', 'Quarta', 'Quinta', 'Sexta', 'SÃ¡bado']
        };
        translations['ko'] = {...translations['en'], 
            title: 'ìˆœë¡€ê¸¸ ë‚ ì”¨', 
            days: 'ì¼',
            weekdays: ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼']
        };

        // å¼¹çª—ç»„ä»¶
        const Modal = ({ isOpen, onClose, title, message, t }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay" onClick={onClose}>
                    <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center gap-3 mb-4">
                            <div className="text-4xl">âš ï¸</div>
                            <h3 className="text-2xl font-bold text-gray-800">{title}</h3>
                        </div>
                        <p className="text-gray-600 mb-6 leading-relaxed">{message}</p>
                        <button 
                            onClick={onClose}
                            className="w-full bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold py-3 px-6 rounded-xl hover:from-amber-600 hover:to-orange-600 transition-all"
                        >
                            {t('understand')}
                        </button>
                    </div>
                </div>
            );
        };

        // åŸå¸‚è‡ªåŠ¨è¡¥å…¨ç»„ä»¶
        const CityAutocomplete = ({ value, onChange, placeholder, dayIndex }) => {
            const [suggestions, setSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);
            const [selectedIndex, setSelectedIndex] = useState(-1);
            const inputRef = useRef(null);
            const dropdownRef = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (inputRef.current && !inputRef.current.contains(event.target) &&
                        dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                        setShowSuggestions(false);
                    }
                };

                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            const handleInputChange = (e) => {
                const inputValue = e.target.value;
                onChange(e);

                if (inputValue.length > 0) {
                    const filtered = CAMINO_CITIES.filter(city =>
                        city.toLowerCase().startsWith(inputValue.toLowerCase())
                    );
                    setSuggestions(filtered);
                    setShowSuggestions(filtered.length > 0);
                    setSelectedIndex(-1);
                } else {
                    setSuggestions([]);
                    setShowSuggestions(false);
                }
            };

            const handleSuggestionClick = (city) => {
                onChange({ target: { value: city } });
                setShowSuggestions(false);
                setSuggestions([]);
            };

            const handleKeyDown = (e) => {
                if (!showSuggestions) return;

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    setSelectedIndex(prev => 
                        prev < suggestions.length - 1 ? prev + 1 : prev
                    );
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    setSelectedIndex(prev => prev > 0 ? prev - 1 : -1);
                } else if (e.key === 'Enter' && selectedIndex >= 0) {
                    e.preventDefault();
                    handleSuggestionClick(suggestions[selectedIndex]);
                } else if (e.key === 'Escape') {
                    setShowSuggestions(false);
                }
            };

            return (
                <div className="relative flex-1">
                    <input
                        ref={inputRef}
                        type="text"
                        value={value}
                        onChange={handleInputChange}
                        onKeyDown={handleKeyDown}
                        onFocus={() => {
                            if (value.length > 0 && suggestions.length > 0) {
                                setShowSuggestions(true);
                            }
                        }}
                        className="w-full px-3 py-2 border rounded-lg"
                        placeholder={placeholder}
                    />
                    {showSuggestions && suggestions.length > 0 && (
                        <div ref={dropdownRef} className="autocomplete-dropdown w-full mt-1">
                            {suggestions.map((city, index) => (
                                <div
                                    key={city}
                                    className={`autocomplete-item ${index === selectedIndex ? 'selected' : ''}`}
                                    onClick={() => handleSuggestionClick(city)}
                                >
                                    {city}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const CaminoWeatherApp = () => {
            const [language, setLanguage] = useState('zh-CN');
            const [unit, setUnit] = useState('metric');
            const [days, setDays] = useState([{ date: '', location: '' }]);
            const [weatherData, setWeatherData] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [copied, setCopied] = useState(false);
            const [viewMode, setViewMode] = useState('cards');
            const [showModal, setShowModal] = useState(false);

            const t = (key) => translations[language][key] || translations['zh-CN'][key];
            const tempUnit = unit === 'metric' ? 'Â°C' : 'Â°F';

            const convertTemp = (celsius) => {
                if (celsius === null || celsius === undefined) return 'N/A';
                return unit === 'imperial' ? Math.round(celsius * 9 / 5 + 32) : Math.round(celsius);
            };

            // åœ°ç‚¹åˆ°AEMETå¸‚é•‡ä»£ç çš„æ˜ å°„
            const locationToMunicipioId = {
                'santiago de compostela': '15078',
                'santiago': '15078',
                'sarria': '27062',
                'portomarin': '27046',
                'portomarÃ­n': '27046',
                'palas de rei': '27039',
                'arzua': '15005',
                'arzÃºa': '15005',
                'o pedrouzo': '15001',
                'pedrouzo': '15001',
                'leon': '24089',
                'leÃ³n': '24089',
                'astorga': '24008',
                'ponferrada': '24115',
                'o cebreiro': '27050',
                'triacastela': '27066',
                'villafranca del bierzo': '24220',
                'burgos': '09059',
                'pamplona': '31201',
                'logroÃ±o': '26089',
                'estella': '31088',
                'santo domingo de la calzada': '26158',
                'najera': '26107',
                'nÃ¡jera': '26107',
                'belorado': '09046',
                'fromista': '34072',
                'frÃ³mista': '34072',
                'carrion de los condes': '34046',
                'carriÃ³n de los condes': '34046',
                'sahagun': '24139',
                'sahagÃºn': '24139',
                'mansilla de las mulas': '24091',
                'porto': '13037',
                'tui': '36057',
                'pontevedra': '36038',
                'padron': '15063',
                'padrÃ³n': '15063',
                'bilbao': '48020',
                'oviedo': '33044',
                'lugo': '27028',
                'foncebadÃ³n': '24063',
                'roncesvalles': '31224',
                'saint-jean-pied-de-port': '64485',
                'zubiri': '31272',
                'puente la reina': '31206',
                'san juan de ortega': '09284',
                'hornillos del camino': '09178',
                'castrojeriz': '09086',
                'terradillos de los templarios': '34900',
                'melide': '15052',
                'ribadiso': '15005',
                'lavacolla': '15078'
            };

            const getMunicipioId = (location) => {
                const normalized = location.toLowerCase().trim();
                return locationToMunicipioId[normalized] || '15078';
            };

            // è®¡ç®—æ—¥æœŸå·®
            const getDaysDifference = (dateString) => {
                const targetDate = new Date(dateString);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                targetDate.setHours(0, 0, 0, 0);
                return Math.floor((targetDate - today) / (1000 * 60 * 60 * 24));
            };

            // é¢„è®¾è·¯çº¿
            const presetRoutes = {
                custom: { days: [{ date: '', location: '' }] },
                frances115: {
                    name: 'æ³•å›½ä¹‹è·¯ 115å…¬é‡Œ',
                    days: [
                        { date: '', location: 'Sarria' },
                        { date: '', location: 'PortomarÃ­n' },
                        { date: '', location: 'Palas de Rei' },
                        { date: '', location: 'ArzÃºa' },
                        { date: '', location: 'O Pedrouzo' },
                        { date: '', location: 'Santiago de Compostela' }
                    ]
                },
                portuguesePorto: {
                    name: 'è‘¡è„ç‰™ä¹‹è·¯ï¼ˆæ³¢å°”å›¾å‡ºå‘ï¼‰',
                    days: [
                        { date: '', location: 'Porto' },
                        { date: '', location: 'Tui' },
                        { date: '', location: 'Pontevedra' },
                        { date: '', location: 'PadrÃ³n' },
                        { date: '', location: 'Santiago de Compostela' }
                    ]
                },
                portugueseLisbon: {
                    name: 'è‘¡è„ç‰™ä¹‹è·¯ï¼ˆé‡Œæ–¯æœ¬å‡ºå‘ï¼‰',
                    days: [
                        { date: '', location: 'Porto' },
                        { date: '', location: 'Tui' },
                        { date: '', location: 'Pontevedra' },
                        { date: '', location: 'PadrÃ³n' },
                        { date: '', location: 'Santiago de Compostela' }
                    ]
                },
                northern: {
                    name: 'åŒ—æ–¹ä¹‹è·¯',
                    days: [
                        { date: '', location: 'Bilbao' },
                        { date: '', location: 'Lugo' },
                        { date: '', location: 'ArzÃºa' },
                        { date: '', location: 'Santiago de Compostela' }
                    ]
                },
                francesFull: {
                    name: 'æ³•å›½ä¹‹è·¯å…¨ç¨‹ï¼ˆ31å¤©ç²¾ç®€ç‰ˆï¼‰',
                    days: [
                        { date: '', location: 'Saint-Jean-Pied-de-Port' },
                        { date: '', location: 'Roncesvalles' },
                        { date: '', location: 'Zubiri' },
                        { date: '', location: 'Pamplona' },
                        { date: '', location: 'Puente la Reina' },
                        { date: '', location: 'Estella' },
                        { date: '', location: 'LogroÃ±o' },
                        { date: '', location: 'NÃ¡jera' },
                        { date: '', location: 'Santo Domingo de la Calzada' },
                        { date: '', location: 'Belorado' },
                        { date: '', location: 'Burgos' },
                        { date: '', location: 'FrÃ³mista' },
                        { date: '', location: 'CarriÃ³n de los Condes' },
                        { date: '', location: 'SahagÃºn' },
                        { date: '', location: 'Mansilla de las Mulas' },
                        { date: '', location: 'LeÃ³n' },
                        { date: '', location: 'Astorga' },
                        { date: '', location: 'FoncebadÃ³n' },
                        { date: '', location: 'Ponferrada' },
                        { date: '', location: 'Villafranca del Bierzo' },
                        { date: '', location: 'O Cebreiro' },
                        { date: '', location: 'Triacastela' },
                        { date: '', location: 'Sarria' },
                        { date: '', location: 'PortomarÃ­n' },
                        { date: '', location: 'Palas de Rei' },
                        { date: '', location: 'ArzÃºa' },
                        { date: '', location: 'O Pedrouzo' },
                        { date: '', location: 'Santiago de Compostela' }
                    ]
                }
            };

            const loadRoute = (routeKey) => {
                setDays([...presetRoutes[routeKey].days]);
                setWeatherData(null);
                setError(null);
            };

            const autoFillDates = () => {
                let startIndex = days.findIndex(d => d.date);
                let startDate = startIndex >= 0 ? new Date(days[startIndex].date) : new Date();
                if (startIndex === -1) startIndex = 0;
                
                setDays(days.map((day, index) => {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + (index - startIndex));
                    return { ...day, date: date.toISOString().split('T')[0] };
                }));
            };

            // è°ƒç”¨AEMET APIè·å–å¤©æ°”
            const fetchWeather = async () => {
                const validDays = days.filter(d => d.date && d.location);
                if (validDays.length === 0) {
                    setError('è¯·å¡«å†™æ—¥æœŸå’Œåœ°ç‚¹');
                    return;
                }

                // æ£€æŸ¥æ˜¯å¦æœ‰è¶…è¿‡1å¹´çš„æ—¥æœŸ
                const hasDateOver1Year = validDays.some(day => getDaysDifference(day.date) > 365);
                if (hasDateOver1Year) {
                    setShowModal(true);
                    return;
                }

                setLoading(true);
                setError(null);
                
                try {
                    const results = await Promise.all(validDays.map(async (day) => {
                        const daysDiff = getDaysDifference(day.date);
                        
                        if (daysDiff > 15) {
                            return await fetchHistoricalWeather(day);
                        } else {
                            return await fetchAEMETWeather(day);
                        }
                    }));
                    
                    setWeatherData(results);
                } catch (err) {
                    console.error('Weather fetch error:', err);
                    setError('è·å–å¤©æ°”å¤±è´¥: ' + err.message);
                } finally {
                    setLoading(false);
                }
            };

            // è·å–AEMETå®æ—¶å¤©æ°”ï¼ˆ0-15å¤©ï¼‰
            const fetchAEMETWeather = async (day) => {
                try {
                    const municipioId = getMunicipioId(day.location);
                    const url = `https://opendata.aemet.es/opendata/api/prediccion/especifica/municipio/diaria/${municipioId}`;
                    
                    const response = await fetch(url, {
                        headers: { 'api_key': AEMET_API_KEY }
                    });

                    if (!response.ok) throw new Error('AEMET API request failed');

                    const result = await response.json();
                    if (result.estado !== 200 || !result.datos) throw new Error('Invalid AEMET response');

                    const dataResponse = await fetch(result.datos);
                    const weatherData = await dataResponse.json();
                    
                    const forecast = weatherData[0]?.prediccion?.dia?.find(d => d.fecha === day.date);
                    if (!forecast) throw new Error('Forecast date not found');

                    const tempMax = forecast.temperatura?.maxima || 15;
                    const tempMin = forecast.temperatura?.minima || 8;
                    const sensMax = forecast.sensTermica?.maxima || tempMax;
                    const sensMin = forecast.sensTermica?.minima || tempMin;
                    
                    let rainProb = 0;
                    if (forecast.probPrecipitacion) {
                        const probs = forecast.probPrecipitacion.map(p => parseInt(p.value) || 0);
                        rainProb = Math.max(...probs);
                    }

                    let condition = 'Despejado';
                    if (forecast.estadoCielo && forecast.estadoCielo.length > 0) {
                        condition = forecast.estadoCielo[0].descripcion || 'Despejado';
                    }

                    const sunrise = forecast.orto || '08:00';
                    const sunset = forecast.ocaso || '18:00';
                    const hasStormWarning = rainProb > 80 || condition.toLowerCase().includes('tormenta');

                    return {
                        location: day.location,
                        date: day.date,
                        isHistorical: false,
                        dayTemp: Math.round(tempMax),
                        nightTemp: Math.round(tempMin),
                        dayFeels: Math.round(sensMax),
                        nightFeels: Math.round(sensMin),
                        rainChance: rainProb,
                        condition: condition,
                        sunrise: sunrise,
                        sunset: sunset,
                        hasStormWarning: hasStormWarning,
                        needUmbrella: rainProb > 50,
                        needWarm: tempMin < 10,
                        dataSource: 'AEMET'
                    };

                } catch (err) {
                    console.error('AEMET fetch error:', err);
                    return getFallbackWeather(day);
                }
            };

            // è·å–å†å²å¹³å‡å¤©æ°”ï¼ˆ>15å¤©ï¼‰
            const fetchHistoricalWeather = async (day) => {
                const targetDate = new Date(day.date);
                const month = targetDate.getMonth() + 1;
                const monthAvg = getMonthlyAverage(month);
                
                return {
                    location: day.location,
                    date: day.date,
                    isHistorical: true,
                    dayTemp: monthAvg.day,
                    nightTemp: monthAvg.night,
                    dayFeels: null,
                    nightFeels: null,
                    rainChance: null,
                    condition: 'N/A',
                    sunrise: null,
                    sunset: null,
                    hasStormWarning: false,
                    needUmbrella: false,
                    needWarm: monthAvg.night < 10,
                    dataSource: 'Historical Average'
                };
            };

            // é™çº§æ–¹æ¡ˆï¼šæ¨¡æ‹Ÿæ•°æ®
            const getFallbackWeather = (day) => {
                const targetDate = new Date(day.date);
                const month = targetDate.getMonth() + 1;
                const monthAvg = getMonthlyAverage(month);
                
                const randomVar = Math.floor(Math.random() * 6) - 3;
                const dayTemp = monthAvg.day + randomVar;
                const nightTemp = monthAvg.night + randomVar;
                const rainChance = Math.floor(Math.random() * 100);
                
                return {
                    location: day.location,
                    date: day.date,
                    isHistorical: false,
                    dayTemp: dayTemp,
                    nightTemp: nightTemp,
                    dayFeels: dayTemp - 2,
                    nightFeels: nightTemp - 2,
                    rainChance: rainChance,
                    condition: ['Despejado', 'Nuboso', 'Lluvia ligera'][Math.floor(Math.random() * 3)],
                    sunrise: '08:00',
                    sunset: '18:30',
                    hasStormWarning: rainChance > 80,
                    needUmbrella: rainChance > 50,
                    needWarm: nightTemp < 10,
                    dataSource: 'Simulated'
                };
            };

            // æœˆåº¦å¹³å‡æ¸©åº¦
            const getMonthlyAverage = (month) => {
                const averages = {
                    1: { day: 11, night: 4 }, 2: { day: 12, night: 4 },
                    3: { day: 14, night: 6 }, 4: { day: 15, night: 7 },
                    5: { day: 18, night: 10 }, 6: { day: 21, night: 13 },
                    7: { day: 23, night: 15 }, 8: { day: 23, night: 15 },
                    9: { day: 21, night: 13 }, 10: { day: 17, night: 10 },
                    11: { day: 13, night: 7 }, 12: { day: 11, night: 5 }
                };
                return averages[month] || { day: 15, night: 8 };
            };

            // å¤åˆ¶è¡¨æ ¼
            const copyTableData = () => {
                if (!weatherData) return;
                let text = `${t('weatherForecast')}\n\n`;
                weatherData.forEach((day, i) => {
                    const translatedCondition = translateWeather(day.condition, language);
                    text += `D${i+1} ${day.location} (${day.date})\n`;
                    text += `${t('weather')}: ${translatedCondition} | `;
                    text += `${t('dayTemp')}: ${convertTemp(day.dayTemp)}${tempUnit} | `;
                    text += `${t('nightTemp')}: ${convertTemp(day.nightTemp)}${tempUnit} | `;
                    text += `${t('rainProb')}: ${day.isHistorical ? '/' : day.rainChance + '%'}\n\n`;
                });
                navigator.clipboard.writeText(text);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const hasHistoricalData = weatherData && weatherData.some(d => d.isHistorical);

            return (
                <div className="p-4 md:p-8 max-w-7xl mx-auto">
                    <Modal 
                        isOpen={showModal}
                        onClose={() => setShowModal(false)}
                        title={t('dateTooFarTitle')}
                        message={t('dateTooFarMessage')}
                        t={t}
                    />

                    <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-10 mb-8">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <div className="flex-1">
                                <h1 className="text-3xl md:text-4xl font-bold text-gray-800 mb-2">{t('title')}</h1>
                                <p className="text-base md:text-lg text-gray-600">{t('subtitle')}</p>
                            </div>
                            <div className="flex gap-3 w-full md:w-auto">
                                <select value={language} onChange={(e) => setLanguage(e.target.value)} className="flex-1 md:flex-none px-3 md:px-4 py-2 border-2 rounded-lg text-sm md:text-base">
                                    <option value="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
                                    <option value="zh-TW">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</option>
                                    <option value="en">ğŸ‡¬ğŸ‡§ English</option>
                                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                                    <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                                </select>
                                <button onClick={() => setUnit(unit === 'metric' ? 'imperial' : 'metric')} className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm md:text-base">
                                    {tempUnit}
                                </button>
                            </div>
                        </div>

                        <div className="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4 mb-6">
                            <h3 className="font-semibold text-blue-900 mb-2 text-sm md:text-base">ğŸ“Š {language.startsWith('zh') ? 'æ•°æ®è¯´æ˜' : 'Data Information'}</h3>
                            <div className="text-xs md:text-sm text-blue-800 space-y-1">
                                <p><strong>â€¢ </strong>{t('dataInfo0to15')}</p>
                                <p><strong>â€¢ </strong>{t('dataInfo15to365')}</p>
                                <p><strong>â€¢ </strong>{t('dataInfoOver1Year')}</p>
                            </div>
                        </div>

                        <div className="bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-4 md:p-6 mb-6">
                            <h2 className="text-lg md:text-xl font-semibold text-gray-800 mb-4">{t('selectRoute')}</h2>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <button onClick={() => loadRoute('custom')} className="p-3 md:p-4 rounded-lg border-2 border-gray-200 bg-white hover:border-amber-500 hover:shadow-lg transition-all text-left">
                                    <div className="font-semibold text-gray-800 text-sm md:text-base">{t('customRoute')}</div>
                                    <div className="text-xs md:text-sm text-gray-600 mt-1">{t('customRouteDesc')}</div>
                                </button>
                                <button onClick={() => loadRoute('frances115')} className="p-3 md:p-4 rounded-lg border-2 border-gray-200 bg-white hover:border-amber-500 hover:shadow-lg transition-all text-left">
                                    <div className="font-semibold text-gray-800 text-sm md:text-base">ğŸ‡«ğŸ‡· {language.startsWith('zh') ? 'æ³•å›½ä¹‹è·¯ 115å…¬é‡Œ' : 'French Way 115km'}</div>
                                    <div className="text-xs md:text-sm text-gray-600 mt-1">Sarria â†’ Santiago (6{language.startsWith('zh') ? 'å¤©' : ' days'})</div>
                                </button>
                                <button onClick={() => loadRoute('portuguesePorto')} className="p-3 md:p-4 rounded-lg border-2 border-gray-200 bg-white hover:border-amber-500 hover:shadow-lg transition-all text-left">
                                    <div className="font-semibold text-gray-800 text-sm md:text-base">ğŸ‡µğŸ‡¹ {language.startsWith('zh') ? 'è‘¡è„ç‰™ä¹‹è·¯ï¼ˆæ³¢å°”å›¾ï¼‰' : 'Portuguese Way (Porto)'}</div>
                                    <div className="text-xs md:text-sm text-gray-600 mt-1">Porto â†’ Santiago</div>
                                </button>
                                <button onClick={() => loadRoute('portugueseLisbon')} className="p-3 md:p-4 rounded-lg border-2 border-gray-200 bg-white hover:border-amber-500 hover:shadow-lg transition-all text-left">
                                    <div className="font-semibold text-gray-800 text-sm md:text-base">ğŸ‡µğŸ‡¹ {language.startsWith('zh') ? 'è‘¡è„ç‰™ä¹‹è·¯ï¼ˆé‡Œæ–¯æœ¬ï¼‰' : 'Portuguese Way (Lisbon)'}</div>
                                    <div className="text-xs md:text-sm text-gray-600 mt-1">Lisbon â†’ Santiago</div>
                                </button>
                                <button onClick={() => loadRoute('northern')} className="p-3 md:p-4 rounded-lg border-2 border-gray-200 bg-white hover:border-amber-500 hover:shadow-lg transition-all text-left">
                                    <div className="font-semibold text-gray-800 text-sm md:text-base">â›°ï¸ {language.startsWith('zh') ? 'åŒ—æ–¹ä¹‹è·¯' : 'Northern Way'}</div>
                                    <div className="text-xs md:text-sm text-gray-600 mt-1">Bilbao â†’ Santiago</div>
                                </button>
                                <button onClick={() => loadRoute('francesFull')} className="p-3 md:p-4 rounded-lg border-2 border-gray-200 bg-white hover:border-amber-500 hover:shadow-lg transition-all text-left">
                                    <div className="font-semibold text-gray-800 text-sm md:text-base">ğŸ‡«ğŸ‡· {language.startsWith('zh') ? 'æ³•å›½ä¹‹è·¯å…¨ç¨‹ï¼ˆ31å¤©ï¼‰' : 'French Way Full (31d)'}</div>
                                    <div className="text-xs md:text-sm text-gray-600 mt-1">SJPP â†’ Santiago</div>
                                </button>
                            </div>
                        </div>

                        <div className="bg-gray-50 rounded-xl p-4 md:p-6">
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-3 mb-4">
                                <h2 className="text-lg md:text-xl font-semibold">{t('itinerary')}ï¼ˆ{t('total')} {days.length} {t('days')}ï¼‰</h2>
                                <button onClick={autoFillDates} className="w-full md:w-auto px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm md:text-base">
                                    {t('autoFillDates')}
                                </button>
                            </div>
                            <div className="space-y-3">
                                {days.map((day, i) => (
                                    <div key={i} className="flex gap-2 md:gap-3 bg-white p-3 rounded-lg">
                                        <span className="text-amber-600 font-semibold w-8 md:w-12 pt-2 text-sm md:text-base">D{i + 1}</span>
                                        <input type="date" value={day.date} onChange={(e) => {
                                            const newDays = [...days];
                                            newDays[i].date = e.target.value;
                                            setDays(newDays);
                                        }} className="px-2 md:px-3 py-2 border rounded-lg text-sm md:text-base" />
                                        <CityAutocomplete
                                            value={day.location}
                                            onChange={(e) => {
                                                const newDays = [...days];
                                                newDays[i].location = e.target.value;
                                                setDays(newDays);
                                            }}
                                            placeholder={t('locationPlaceholder')}
                                            dayIndex={i}
                                        />
                                        <button onClick={() => setDays(days.filter((_, idx) => idx !== i))} disabled={days.length === 1} className="p-2 text-red-500 hover:bg-red-50 rounded-lg disabled:opacity-30 transition">
                                            ğŸ—‘ï¸
                                        </button>
                                    </div>
                                ))}
                            </div>
                            <button onClick={() => setDays([...days, { date: '', location: '' }])} className="w-full mt-4 py-3 border-2 border-dashed border-gray-300 hover:border-amber-500 rounded-lg transition text-sm md:text-base">
                                + {t('addDay')}
                            </button>
                        </div>

                        {error && (
                            <div className="mt-6 bg-red-50 border-2 border-red-300 rounded-xl p-4">
                                <div className="text-red-800 text-sm md:text-base">{error}</div>
                            </div>
                        )}

                        <div className="mt-6">
                            <button onClick={fetchWeather} disabled={loading} className="w-full bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold py-3 md:py-4 px-6 rounded-xl hover:from-amber-600 hover:to-orange-600 disabled:opacity-50 transition-all text-sm md:text-base">
                                {loading ? <span className="loading-pulse">â˜ï¸ {t('querying')}</span> : `â˜ï¸ ${t('queryWeather')}`}
                            </button>
                        </div>
                    </div>

                    {weatherData && weatherData.length > 0 && (
                        <div className="bg-white rounded-3xl shadow-2xl p-4 md:p-10">
                            {hasHistoricalData && (
                                <div className="mb-6 bg-yellow-50 border-2 border-yellow-400 rounded-xl p-4">
                                    <div className="flex items-center gap-2 text-yellow-800 font-semibold mb-2 text-sm md:text-base">
                                        ğŸ“Š {t('historicalDataBadge')}
                                    </div>
                                    <p className="text-yellow-700 text-xs md:text-sm">{t('historicalDataWarning')}</p>
                                </div>
                            )}
                            
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-3 mb-6">
                                <h2 className="text-2xl md:text-3xl font-bold">{t('weatherForecast')}</h2>
                                <div className="flex gap-2 md:gap-3 w-full md:w-auto">
                                    <button onClick={() => setViewMode(viewMode === 'cards' ? 'table' : 'cards')} className="flex-1 md:flex-none px-3 md:px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition text-sm md:text-base">
                                        {viewMode === 'cards' ? t('cardView') : t('tableView')}
                                    </button>
                                    {viewMode === 'table' && (
                                        <button onClick={copyTableData} className="flex-1 md:flex-none px-4 md:px-6 py-2 md:py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 transition text-sm md:text-base">
                                            {copied ? 'âœ“ ' + t('copied') : t('copyTable')}
                                        </button>
                                    )}
                                </div>
                            </div>

                            {viewMode === 'cards' ? (
                                <div className="space-y-4">
                                    {weatherData.map((day, i) => {
                                        const weekDay = t('weekdays')[new Date(day.date).getDay()];
                                        const cardClass = day.isHistorical ? 'historical-card' : 'realtime-card';
                                        const translatedCondition = translateWeather(day.condition, language);
                                        const weatherIcon = getWeatherIcon(day.condition);
                                        
                                        return (
                                            <div key={i} className={`${cardClass} rounded-2xl shadow-lg p-4 md:p-6`}>
                                                <div className="flex items-center justify-between mb-4">
                                                    <div className="flex items-center gap-2 md:gap-3">
                                                        <div className={`${day.isHistorical ? 'bg-amber-600' : 'bg-blue-600'} text-white rounded-full w-10 h-10 md:w-12 md:h-12 flex items-center justify-center font-bold text-sm md:text-base`}>
                                                            D{i + 1}
                                                        </div>
                                                        <div>
                                                            <div className="text-xl md:text-2xl font-bold">{day.location}</div>
                                                            <div className="text-xs md:text-sm text-gray-600">{day.date.substring(5)} {weekDay}</div>
                                                        </div>
                                                    </div>
                                                    <div className={`px-2 md:px-3 py-1 rounded-full text-xs font-semibold ${day.isHistorical ? 'bg-amber-200 text-amber-800' : 'bg-blue-200 text-blue-800'}`}>
                                                        {day.isHistorical ? 'ğŸ“Š ' + t('historicalDataBadge') : 'ğŸŒ ' + t('realTimeForecast')}
                                                    </div>
                                                </div>

                                                <div className="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-4">
                                                    <div className={`${day.isHistorical ? 'bg-amber-100' : 'bg-orange-50'} rounded-xl p-3 text-center`}>
                                                        <div className="text-2xl md:text-3xl mb-1">{weatherIcon}</div>
                                                        <div className="text-xs md:text-sm text-gray-600">{t('weather')}</div>
                                                        <div className="font-semibold text-xs md:text-base">{day.isHistorical ? 'N/A' : translatedCondition}</div>
                                                    </div>
                                                    <div className={`${day.isHistorical ? 'bg-red-100' : 'bg-red-50'} rounded-xl p-3 text-center`}>
                                                        <div className="text-2xl md:text-3xl mb-1">ğŸŒ¡ï¸</div>
                                                        <div className="text-xs md:text-sm text-gray-600">{t('dayTemp')}</div>
                                                        <div className="font-bold text-xl md:text-2xl text-red-600">{convertTemp(day.dayTemp)}{tempUnit}</div>
                                                        {day.dayFeels && (
                                                            <div className="text-xs text-gray-500 mt-1">
                                                                {t('feelsLike')} {convertTemp(day.dayFeels)}{tempUnit}
                                                            </div>
                                                        )}
                                                    </div>
                                                    <div className={`${day.isHistorical ? 'bg-blue-100' : 'bg-blue-50'} rounded-xl p-3 text-center`}>
                                                        <div className="text-2xl md:text-3xl mb-1">ğŸŒ™</div>
                                                        <div className="text-xs md:text-sm text-gray-600">{t('nightTemp')}</div>
                                                        <div className="font-bold text-xl md:text-2xl text-blue-600">{convertTemp(day.nightTemp)}{tempUnit}</div>
                                                        {day.nightFeels && (
                                                            <div className="text-xs text-gray-500 mt-1">
                                                                {t('feelsLike')} {convertTemp(day.nightFeels)}{tempUnit}
                                                            </div>
                                                        )}
                                                    </div>
                                                    <div className={`${day.isHistorical ? 'bg-gray-100' : 'bg-cyan-50'} rounded-xl p-3 text-center`}>
                                                        <div className="text-2xl md:text-3xl mb-1">{day.isHistorical ? 'ğŸ“Š' : 'ğŸ’§'}</div>
                                                        <div className="text-xs md:text-sm text-gray-600">{t('rainProb')}</div>
                                                        <div className="font-bold text-lg md:text-xl">{day.isHistorical ? '/' : `${day.rainChance}%`}</div>
                                                        {day.isHistorical && <div className="text-xs text-gray-500 mt-1">{t('noRainData')}</div>}
                                                    </div>
                                                </div>

                                                {!day.isHistorical && day.sunrise && day.sunset && (
                                                    <div className="bg-gradient-to-r from-orange-50 to-purple-50 rounded-xl p-3 mb-3">
                                                        <div className="flex justify-around text-xs md:text-sm">
                                                            <div className="text-center">
                                                                <div className="text-orange-600 font-semibold">ğŸŒ… {t('sunrise')}</div>
                                                                <div className="font-bold text-base md:text-lg">{day.sunrise}</div>
                                                            </div>
                                                            <div className="text-center">
                                                                <div className="text-purple-600 font-semibold">ğŸŒ‡ {t('sunset')}</div>
                                                                <div className="font-bold text-base md:text-lg">{day.sunset}</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}

                                                <div className="flex flex-wrap gap-2">
                                                    {day.hasStormWarning && (
                                                        <div className="bg-red-100 text-red-800 px-2 md:px-3 py-1 rounded-full text-xs md:text-sm font-semibold">
                                                            {t('stormWarning')}
                                                        </div>
                                                    )}
                                                    {day.needUmbrella && !day.hasStormWarning && (
                                                        <div className="bg-blue-100 text-blue-800 px-2 md:px-3 py-1 rounded-full text-xs md:text-sm font-semibold">
                                                            {t('bringUmbrella')}
                                                        </div>
                                                    )}
                                                    {day.needWarm && (
                                                        <div className="bg-orange-100 text-orange-800 px-2 md:px-3 py-1 rounded-full text-xs md:text-sm font-semibold">
                                                            {t('keepWarm')}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            ) : (
                                <div className="bg-gray-50 p-4 md:p-6 rounded-xl overflow-x-auto">
                                    <table className="w-full text-xs md:text-sm">
                                        <thead>
                                            <tr className="border-b-2 border-gray-300">
                                                <th className="text-left p-2">{t('itinerary')}</th>
                                                <th className="text-center p-2">{t('weather')}</th>
                                                <th className="text-center p-2">{t('dayTemp')}</th>
                                                <th className="text-center p-2">{t('nightTemp')}</th>
                                                <th className="text-center p-2">{t('rainProb')}</th>
                                                <th className="text-center p-2 hidden md:table-cell">{t('sunrise')}/{t('sunset')}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {weatherData.map((day, i) => {
                                                const translatedCondition = translateWeather(day.condition, language);
                                                return (
                                                    <tr key={i} className={`border-b border-gray-200 ${day.isHistorical ? 'bg-yellow-50' : ''}`}>
                                                        <td className="p-2">
                                                            <div className="font-semibold">D{i+1} {day.location}</div>
                                                            <div className="text-xs text-gray-500">{day.date}</div>
                                                        </td>
                                                        <td className="text-center p-2">{day.isHistorical ? 'N/A' : translatedCondition}</td>
                                                        <td className="text-center p-2">
                                                            <div className="font-semibold text-red-600">{convertTemp(day.dayTemp)}{tempUnit}</div>
                                                            {day.dayFeels && <div className="text-xs text-gray-500">{convertTemp(day.dayFeels)}{tempUnit}</div>}
                                                        </td>
                                                        <td className="text-center p-2">
                                                            <div className="font-semibold text-blue-600">{convertTemp(day.nightTemp)}{tempUnit}</div>
                                                            {day.nightFeels && <div className="text-xs text-gray-500">{convertTemp(day.nightFeels)}{tempUnit}</div>}
                                                        </td>
                                                        <td className="text-center p-2">{day.isHistorical ? '/' : `${day.rainChance}%`}</td>
                                                        <td className="text-center p-2 text-xs hidden md:table-cell">
                                                            {day.sunrise && day.sunset ? `${day.sunrise} / ${day.sunset}` : '-'}
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            )}

                            <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-4">
                                    <h3 className="font-semibold text-blue-800 mb-2 text-sm md:text-base">{t('usageTip')}</h3>
                                    <p className="text-xs md:text-sm text-blue-700">{t('usageTipText')}</p>
                                </div>
                                <div className="bg-amber-50 border-2 border-amber-200 rounded-xl p-4">
                                    <h3 className="font-semibold text-amber-800 mb-2 text-sm md:text-base">{t('notice')}</h3>
                                    <p className="text-xs md:text-sm text-amber-700">{t('noticeText')}</p>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="mt-8 text-center text-gray-600 text-xs md:text-sm">
                        <p>{t('footerText')}</p>
                        <p className="mt-2">{t('dataSource')}</p>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<CaminoWeatherApp />, document.getElementById('root'));
    </script>
</body>
</html>