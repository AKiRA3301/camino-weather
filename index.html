<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="æœåœ£ä¹‹è·¯å¤©æ°”æŸ¥è¯¢å·¥å…· - æ”¯æŒ8ç§è¯­è¨€">
    <title>æœåœ£ä¹‹è·¯å¤©æ°”æŸ¥è¯¢å·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif; }
        
        /* å†å²æ•°æ®å¡ç‰‡ç‰¹æ®Šæ ·å¼ */
        .historical-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px dashed #f59e0b !important;
        }
        
        /* å®æ—¶æ•°æ®å¡ç‰‡æ ·å¼ */
        .realtime-card {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            border: 2px solid #e5e7eb;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 min-h-screen">
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState } = React;

        // å¤šè¯­è¨€ç¿»è¯‘å­—å…¸
        const translations = {
            'zh-CN': {
                title: 'æœåœ£ä¹‹è·¯å¤©æ°”æŸ¥è¯¢',
                subtitle: 'ä¸ºæ‰€æœ‰æœåœ£è€…æä¾›ç²¾å‡†çš„å¤©æ°”é¢„æŠ¥æœåŠ¡ â€¢ æ”¯æŒæ‰€æœ‰è·¯çº¿ â€¢ å†å²æ•°æ®å‚è€ƒ',
                selectRoute: 'é€‰æ‹©è·¯çº¿',
                customRoute: 'âœ¨ è‡ªå®šä¹‰è·¯çº¿',
                customRouteDesc: 'åˆ›å»ºä½ çš„ä¸“å±è·¯çº¿',
                itinerary: 'è¡Œç¨‹å®‰æ’',
                days: 'å¤©',
                total: 'å…±',
                autoFillDates: 'è‡ªåŠ¨å¡«å……æ—¥æœŸ',
                addDay: 'æ·»åŠ ä¸€å¤©',
                locationPlaceholder: 'è¾“å…¥åŸé•‡åç§°ï¼ˆå¦‚ï¼šSantiago de Compostelaï¼‰',
                queryWeather: 'æŸ¥è¯¢å¤©æ°”é¢„æŠ¥',
                querying: 'æ­£åœ¨æŸ¥è¯¢å¤©æ°”...',
                weatherForecast: 'å¤©æ°”é¢„æŠ¥',
                cardView: 'ğŸ“‹ è¡¨æ ¼è§†å›¾',
                tableView: 'ğŸ´ å¡ç‰‡è§†å›¾',
                copyTable: 'å¤åˆ¶è¡¨æ ¼',
                copied: 'å·²å¤åˆ¶',
                weather: 'å¤©æ°”',
                dayTemp: 'æ—¥é—´æ¸©åº¦',
                nightTemp: 'å¤œé—´æ¸©åº¦',
                rainProb: 'é™é›¨æ¦‚ç‡',
                usageTip: 'ğŸ’¡ ä½¿ç”¨æç¤º',
                usageTipText: 'åˆ‡æ¢"å¡ç‰‡è§†å›¾"æŸ¥çœ‹ç¾è§‚ç•Œé¢ï¼Œæˆ–"è¡¨æ ¼è§†å›¾"å¤åˆ¶æ–‡æœ¬ã€‚',
                notice: 'âš ï¸ æ³¨æ„äº‹é¡¹',
                noticeText: 'å±±åŒºå¤©æ°”å˜åŒ–å¿«ï¼Œé‡æç«¯å¤©æ°”é¢„è­¦è¯·è°ƒæ•´è¡Œç¨‹ã€‚å®‰å…¨ç¬¬ä¸€ï¼',
                footerText: 'æœ¬å·¥å…·ä¸ºæœåœ£ä¹‹è·¯å¾’æ­¥è€…æä¾›ä¾¿æ·çš„å¤©æ°”æŸ¥è¯¢æœåŠ¡',
                dataSource: 'æ•°æ®æ¥æºï¼šOpen-Meteoï¼ˆå…è´¹å¤©æ°”APIï¼‰',
                weekdays: ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'],
                historicalDataWarning: 'æç¤ºï¼šæ‚¨é€‰æ‹©çš„æ—¥æœŸè¶…å‡ºå¤©æ°”é¢„æŠ¥èŒƒå›´ï¼ˆæœ€å¤šæå‰15å¤©ï¼‰ã€‚ä»¥ä¸‹æ˜¾ç¤ºçš„æ˜¯åŸºäºå†å²æ•°æ®çš„å‚è€ƒä¿¡æ¯ï¼Œä»…ä¾›è§„åˆ’å‚è€ƒã€‚å»ºè®®å‡ºå‘å‰2å‘¨å†æ¬¡æŸ¥è¯¢å®æ—¶å¤©æ°”é¢„æŠ¥è·å–æœ€å‡†ç¡®çš„ä¿¡æ¯ã€‚',
                historicalDataBadge: 'å†å²å¹³å‡æ•°æ®',
                realTimeForecast: 'å®æ—¶å¤©æ°”é¢„æŠ¥',
                dataSourceLabel: 'æ•°æ®æ¥æº',
                historicalAvgSource: 'åŸºäºå†å²å¹³å‡å€¼',
                realtimeSource: 'å®æ—¶é¢„æŠ¥',
                errorFetchingWeather: 'è·å–å¤©æ°”æ•°æ®å¤±è´¥',
                retryQuery: 'é‡è¯•',
                noRainData: 'å†å²æ•°æ®æ— é™é›¨ç‡'
            },
            'en': {
                title: 'Camino Weather Tool',
                subtitle: 'Accurate weather forecasts for all pilgrims â€¢ All routes supported â€¢ Historical data',
                selectRoute: 'Select Route',
                customRoute: 'âœ¨ Custom Route',
                customRouteDesc: 'Create your own route',
                itinerary: 'Itinerary',
                days: 'days',
                total: 'Total',
                autoFillDates: 'Auto-fill Dates',
                addDay: 'Add Day',
                locationPlaceholder: 'Enter town name (e.g., Santiago de Compostela)',
                queryWeather: 'Check Weather',
                querying: 'Checking weather...',
                weatherForecast: 'Weather Forecast',
                cardView: 'ğŸ“‹ Table View',
                tableView: 'ğŸ´ Card View',
                copyTable: 'Copy Table',
                copied: 'Copied',
                weather: 'Weather',
                dayTemp: 'Day Temp',
                nightTemp: 'Night Temp',
                rainProb: 'Rain Probability',
                usageTip: 'ğŸ’¡ Usage Tip',
                usageTipText: 'Switch to "Card View" for better display, or "Table View" to copy text.',
                notice: 'âš ï¸ Notice',
                noticeText: 'Mountain weather changes rapidly. Adjust your plan if extreme weather. Safety first!',
                footerText: 'Weather tool for Camino de Santiago pilgrims',
                dataSource: 'Data source: Open-Meteo (Free Weather API)',
                weekdays: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                historicalDataWarning: 'Notice: Your selected dates exceed weather forecast range (max 15 days ahead). Data shown is based on historical averages for planning reference only. Please check actual forecast 2 weeks before departure.',
                historicalDataBadge: 'Historical Average Data',
                realTimeForecast: 'Real-time Forecast',
                dataSourceLabel: 'Data Source',
                historicalAvgSource: 'Based on historical average',
                realtimeSource: 'Real-time forecast',
                errorFetchingWeather: 'Failed to fetch weather data',
                retryQuery: 'Retry',
                noRainData: 'No rain data for historical'
            },
            'es': {
                title: 'Herramienta del Tiempo del Camino',
                subtitle: 'Previsiones meteorolÃ³gicas precisas para todos los peregrinos',
                selectRoute: 'Seleccionar Ruta',
                customRoute: 'âœ¨ Ruta Personalizada',
                customRouteDesc: 'Crea tu propia ruta',
                itinerary: 'Itinerario',
                days: 'dÃ­as',
                total: 'Total',
                autoFillDates: 'Rellenar Fechas',
                addDay: 'AÃ±adir DÃ­a',
                locationPlaceholder: 'Introduce el nombre del pueblo',
                queryWeather: 'Consultar Tiempo',
                querying: 'Consultando...',
                weatherForecast: 'PrevisiÃ³n del Tiempo',
                cardView: 'ğŸ“‹ Vista de Tabla',
                tableView: 'ğŸ´ Vista de Tarjetas',
                copyTable: 'Copiar Tabla',
                copied: 'Copiado',
                weather: 'Tiempo',
                dayTemp: 'Temp. DÃ­a',
                nightTemp: 'Temp. Noche',
                rainProb: 'Prob. Lluvia',
                usageTip: 'ğŸ’¡ Consejo',
                usageTipText: 'Cambia a "Vista de Tarjetas" para mejor visualizaciÃ³n.',
                notice: 'âš ï¸ Aviso',
                noticeText: 'Â¡El tiempo en montaÃ±a cambia rÃ¡pido. Seguridad primero!',
                footerText: 'Herramienta meteorolÃ³gica para peregrinos del Camino',
                dataSource: 'Fuente de datos: Open-Meteo',
                weekdays: ['Dom', 'Lun', 'Mar', 'MiÃ©', 'Jue', 'Vie', 'SÃ¡b'],
                historicalDataWarning: 'Aviso: Las fechas exceden el rango de pronÃ³stico. Datos histÃ³ricos solo para referencia.',
                historicalDataBadge: 'Datos HistÃ³ricos',
                realTimeForecast: 'PronÃ³stico en Tiempo Real',
                dataSourceLabel: 'Fuente',
                historicalAvgSource: 'Promedio histÃ³rico',
                realtimeSource: 'PronÃ³stico en tiempo real',
                errorFetchingWeather: 'Error al obtener datos',
                retryQuery: 'Reintentar',
                noRainData: 'Sin datos de lluvia'
            }
        };

        // å…¶ä»–è¯­è¨€ç®€åŒ–ç‰ˆ
        translations['zh-TW'] = {...translations['zh-CN'], title: 'æœè–ä¹‹è·¯å¤©æ°£æŸ¥è©¢'};
        translations['fr'] = {...translations['en'], title: 'MÃ©tÃ©o du Chemin', days: 'jours'};
        translations['de'] = {...translations['en'], title: 'Camino Wetter', days: 'Tage'};
        translations['pt'] = {...translations['en'], title: 'Tempo do Caminho', days: 'dias'};
        translations['ko'] = {...translations['en'], title: 'ìˆœë¡€ê¸¸ ë‚ ì”¨', days: 'ì¼'};

        const CaminoWeatherApp = () => {
            const [language, setLanguage] = useState('zh-CN');
            const [unit, setUnit] = useState('metric');
            const [days, setDays] = useState([{ date: '', location: '' }]);
            const [weatherData, setWeatherData] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [copied, setCopied] = useState(false);
            const [viewMode, setViewMode] = useState('cards');

            const t = (key) => translations[language][key] || translations['zh-CN'][key];
            const tempUnit = unit === 'metric' ? 'Â°C' : 'Â°F';

            const convertTemp = (celsius) => {
                if (celsius === null || celsius === undefined) return 'N/A';
                return unit === 'imperial' ? Math.round(celsius * 9 / 5 + 32) : Math.round(celsius);
            };

            // åœ°ç‚¹åæ ‡æ˜ å°„ï¼ˆæœåœ£ä¹‹è·¯ä¸»è¦åŸé•‡ï¼‰
            const locationCoords = {
                'santiago de compostela': { lat: 42.88, lon: -8.54 },
                'santiago': { lat: 42.88, lon: -8.54 },
                'sarria': { lat: 42.78, lon: -7.42 },
                'portomarin': { lat: 42.81, lon: -7.62 },
                'palas de rei': { lat: 42.87, lon: -7.86 },
                'arzua': { lat: 42.93, lon: -8.16 },
                'o pedrouzo': { lat: 42.92, lon: -8.42 },
                'leon': { lat: 42.60, lon: -5.57 },
                'astorga': { lat: 42.46, lon: -6.05 },
                'ponferrada': { lat: 42.55, lon: -6.59 },
                'o cebreiro': { lat: 42.71, lon: -7.04 },
                'triacastela': { lat: 42.76, lon: -7.24 },
                'villafranca del bierzo': { lat: 42.61, lon: -6.81 },
                'burgos': { lat: 42.34, lon: -3.70 },
                'pamplona': { lat: 42.82, lon: -1.64 },
                'logroÃ±o': { lat: 42.47, lon: -2.45 },
                'estella': { lat: 42.67, lon: -2.03 },
                'porto': { lat: 41.16, lon: -8.62 },
                'tui': { lat: 42.05, lon: -8.64 },
                'pontevedra': { lat: 42.43, lon: -8.64 },
                'bilbao': { lat: 43.26, lon: -2.93 },
                'oviedo': { lat: 43.36, lon: -5.84 },
                'lugo': { lat: 43.01, lon: -7.56 }
            };

            // è·å–åœ°ç‚¹åæ ‡
            const getCoords = (location) => {
                const normalized = location.toLowerCase().trim();
                return locationCoords[normalized] || { lat: 42.88, lon: -8.54 }; // é»˜è®¤åœ£åœ°äºšå“¥
            };

            // è®¡ç®—æ—¥æœŸå·®
            const getDaysDifference = (dateString) => {
                const targetDate = new Date(dateString);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                targetDate.setHours(0, 0, 0, 0);
                return Math.floor((targetDate - today) / (1000 * 60 * 60 * 24));
            };

            // é¢„è®¾è·¯çº¿
            const presetRoutes = {
                custom: { days: [{ date: '', location: '' }] },
                frances115: {
                    days: [
                        { date: '', location: 'Sarria' },
                        { date: '', location: 'Portomarin' },
                        { date: '', location: 'Palas de Rei' },
                        { date: '', location: 'Arzua' },
                        { date: '', location: 'O Pedrouzo' },
                        { date: '', location: 'Santiago de Compostela' }
                    ]
                },
                francesFull: {
                    days: [
                        { date: '', location: 'Pamplona' },
                        { date: '', location: 'Estella' },
                        { date: '', location: 'LogroÃ±o' },
                        { date: '', location: 'Burgos' },
                        { date: '', location: 'Leon' },
                        { date: '', location: 'Astorga' },
                        { date: '', location: 'Ponferrada' },
                        { date: '', location: 'O Cebreiro' },
                        { date: '', location: 'Sarria' },
                        { date: '', location: 'Santiago de Compostela' }
                    ]
                },
                portuguese: {
                    days: [
                        { date: '', location: 'Porto' },
                        { date: '', location: 'Tui' },
                        { date: '', location: 'Pontevedra' },
                        { date: '', location: 'Santiago de Compostela' }
                    ]
                }
            };

            const loadRoute = (routeKey) => {
                setDays([...presetRoutes[routeKey].days]);
                setWeatherData(null);
                setError(null);
            };

            const autoFillDates = () => {
                let startIndex = days.findIndex(d => d.date);
                let startDate = startIndex >= 0 ? new Date(days[startIndex].date) : new Date();
                if (startIndex === -1) startIndex = 0;
                
                setDays(days.map((day, index) => {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + (index - startIndex));
                    return { ...day, date: date.toISOString().split('T')[0] };
                }));
            };

            // è°ƒç”¨Open-Meteo APIè·å–å¤©æ°”
            const fetchWeather = async () => {
                const validDays = days.filter(d => d.date && d.location);
                if (validDays.length === 0) {
                    setError('è¯·å¡«å†™æ—¥æœŸå’Œåœ°ç‚¹');
                    return;
                }

                setLoading(true);
                setError(null);
                
                try {
                    const results = await Promise.all(validDays.map(async (day) => {
                        const coords = getCoords(day.location);
                        const daysDiff = getDaysDifference(day.date);
                        
                        // è¶…è¿‡15å¤©ä½¿ç”¨å†å²æ•°æ®API
                        if (daysDiff > 15) {
                            return await fetchHistoricalWeather(day, coords);
                        } else {
                            return await fetchRealtimeWeather(day, coords);
                        }
                    }));
                    
                    setWeatherData(results);
                } catch (err) {
                    console.error('Weather fetch error:', err);
                    setError('è·å–å¤©æ°”å¤±è´¥: ' + err.message);
                } finally {
                    setLoading(false);
                }
            };

            // è·å–å®æ—¶å¤©æ°”ï¼ˆ0-15å¤©ï¼‰
            const fetchRealtimeWeather = async (day, coords) => {
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max,weathercode&timezone=Europe/Madrid&forecast_days=16`;
                
                const response = await fetch(url);
                if (!response.ok) throw new Error('API request failed');
                
                const data = await response.json();
                const dateIndex = data.daily.time.indexOf(day.date);
                
                if (dateIndex === -1) {
                    throw new Error('Date not found in forecast');
                }
                
                return {
                    location: day.location,
                    date: day.date,
                    isHistorical: false,
                    dayTemp: Math.round(data.daily.temperature_2m_max[dateIndex]),
                    nightTemp: Math.round(data.daily.temperature_2m_min[dateIndex]),
                    rainChance: data.daily.precipitation_probability_max[dateIndex] || 0,
                    condition: getWeatherDescription(data.daily.weathercode[dateIndex]),
                    dataSource: 'Open-Meteo'
                };
            };

            // è·å–å†å²å¹³å‡å¤©æ°”ï¼ˆ>15å¤©ï¼‰
            const fetchHistoricalWeather = async (day, coords) => {
                const targetDate = new Date(day.date);
                const month = targetDate.getMonth() + 1;
                
                // ä½¿ç”¨å»å¹´åŒæœŸæ•°æ®ä½œä¸ºå‚è€ƒ
                const lastYear = new Date(targetDate);
                lastYear.setFullYear(lastYear.getFullYear() - 1);
                const startDate = lastYear.toISOString().split('T')[0];
                
                const url = `https://archive-api.open-meteo.com/v1/archive?latitude=${coords.lat}&longitude=${coords.lon}&start_date=${startDate}&end_date=${startDate}&daily=temperature_2m_max,temperature_2m_min&timezone=Europe/Madrid`;
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('Historical API failed');
                    
                    const data = await response.json();
                    
                    return {
                        location: day.location,
                        date: day.date,
                        isHistorical: true,
                        dayTemp: Math.round(data.daily.temperature_2m_max[0]),
                        nightTemp: Math.round(data.daily.temperature_2m_min[0]),
                        rainChance: null,
                        condition: 'N/A',
                        dataSource: 'Historical Average'
                    };
                } catch (err) {
                    // å¦‚æœå†å²APIå¤±è´¥ï¼Œä½¿ç”¨æœˆåº¦å¹³å‡ä¼°ç®—
                    const monthAvg = getMonthlyAverage(month);
                    return {
                        location: day.location,
                        date: day.date,
                        isHistorical: true,
                        dayTemp: monthAvg.day,
                        nightTemp: monthAvg.night,
                        rainChance: null,
                        condition: 'N/A',
                        dataSource: 'Monthly Average'
                    };
                }
            };

            // æœˆåº¦å¹³å‡æ¸©åº¦ï¼ˆåœ£åœ°äºšå“¥ï¼‰
            const getMonthlyAverage = (month) => {
                const averages = {
                    1: { day: 11, night: 4 }, 2: { day: 12, night: 4 },
                    3: { day: 14, night: 6 }, 4: { day: 15, night: 7 },
                    5: { day: 18, night: 10 }, 6: { day: 21, night: 13 },
                    7: { day: 23, night: 15 }, 8: { day: 23, night: 15 },
                    9: { day: 21, night: 13 }, 10: { day: 17, night: 10 },
                    11: { day: 13, night: 7 }, 12: { day: 11, night: 5 }
                };
                return averages[month] || { day: 15, night: 8 };
            };

            // å¤©æ°”ä»£ç è½¬æè¿°
            const getWeatherDescription = (code) => {
                const descriptions = {
                    0: 'æ™´å¤©', 1: 'æ™´', 2: 'å¤šäº‘', 3: 'é˜´å¤©',
                    45: 'é›¾', 48: 'é›¾', 51: 'å°é›¨', 53: 'ä¸­é›¨', 55: 'å¤§é›¨',
                    61: 'å°é›¨', 63: 'ä¸­é›¨', 65: 'å¤§é›¨', 80: 'é˜µé›¨', 95: 'é›·æš´'
                };
                return descriptions[code] || 'æœªçŸ¥';
            };

            // å¤åˆ¶è¡¨æ ¼
            const copyTableData = () => {
                if (!weatherData) return;
                let text = `${t('weatherForecast')}\n\n`;
                weatherData.forEach((day, i) => {
                    text += `D${i+1} ${day.location} (${day.date})\n`;
                    text += `${t('dayTemp')}: ${convertTemp(day.dayTemp)}${tempUnit} | `;
                    text += `${t('nightTemp')}: ${convertTemp(day.nightTemp)}${tempUnit} | `;
                    text += `${t('rainProb')}: ${day.isHistorical ? '/' : day.rainChance + '%'}\n\n`;
                });
                navigator.clipboard.writeText(text);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const hasHistoricalData = weatherData && weatherData.some(d => d.isHistorical);

            return (
                <div className="p-4 md:p-8 max-w-7xl mx-auto">
                    <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-10 mb-8">
                        <div className="flex justify-between items-start mb-6">
                            <div>
                                <h1 className="text-4xl font-bold text-gray-800 mb-2">{t('title')}</h1>
                                <p className="text-lg text-gray-600">{t('subtitle')}</p>
                            </div>
                            <div className="flex gap-3">
                                <select value={language} onChange={(e) => setLanguage(e.target.value)} className="px-4 py-2 border-2 rounded-lg">
                                    <option value="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
                                    <option value="zh-TW">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</option>
                                    <option value="en">ğŸ‡¬ğŸ‡§ English</option>
                                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                                    <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                                </select>
                                <button onClick={() => setUnit(unit === 'metric' ? 'imperial' : 'metric')} className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                                    {tempUnit}
                                </button>
                            </div>
                        </div>

                        <div className="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4 mb-6">
                            <h3 className="font-semibold text-blue-900 mb-2">ğŸ“Š {language.startsWith('zh') ? 'æ•°æ®è¯´æ˜' : 'Data Information'}</h3>
                            <div className="text-sm text-blue-800 space-y-1">
                                <p><strong>â€¢ 0-15å¤©ï¼š</strong>{language.startsWith('zh') ? 'å®æ—¶å¤©æ°”é¢„æŠ¥' : 'Real-time forecast'}</p>
                                <p><strong>â€¢ 15å¤©ä»¥ä¸Šï¼š</strong>{language.startsWith('zh') ? 'å†å²å¹³å‡æ•°æ®ï¼ˆä»…ä¾›å‚è€ƒï¼‰' : 'Historical average (reference only)'}</p>
                            </div>
                        </div>

                        <div className="bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-6 mb-6">
                            <h2 className="text-xl font-semibold text-gray-800 mb-4">{t('selectRoute')}</h2>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <button onClick={() => loadRoute('custom')} className="p-4 rounded-lg border-2 border-gray-200 bg-white hover:border-amber-500 hover:shadow-lg transition-all text-left">
                                    <div className="font-semibold text-gray-800">{t('customRoute')}</div>
                                    <div className="text-sm text-gray-600 mt-1">{t('customRouteDesc')}</div>
                                </button>
                                <button onClick={() => loadRoute('frances115')} className="p-4 rounded-lg border-2 border-gray-200 bg-white hover:border-amber-500 hover:shadow-lg transition-all text-left">
                                    <div className="font-semibold text-gray-800">ğŸ‡«ğŸ‡· {language.startsWith('zh') ? 'æ³•å›½ä¹‹è·¯ 115km' : 'French Way 115km'}</div>
                                    <div className="text-sm text-gray-600 mt-1">Sarria â†’ Santiago (6{language.startsWith('zh') ? 'å¤©' : ' days'})</div>
                                </button>
                                <button onClick={() => loadRoute('francesFull')} className="p-4 rounded-lg border-2 border-gray-200 bg-white hover:border-amber-500 hover:shadow-lg transition-all text-left">
                                    <div className="font-semibold text-gray-800">ğŸ‡«ğŸ‡· {language.startsWith('zh') ? 'æ³•å›½ä¹‹è·¯ï¼ˆç²¾ç®€ï¼‰' : 'French Way (Short)'}</div>
                                    <div className="text-sm text-gray-600 mt-1">10{language.startsWith('zh') ? 'å¤©ç²¾ç®€ç‰ˆ' : ' days'}</div>
                                </button>
                                <button onClick={() => loadRoute('portuguese')} className="p-4 rounded-lg border-2 border-gray-200 bg-white hover:border-amber-500 hover:shadow-lg transition-all text-left">
                                    <div className="font-semibold text-gray-800">ğŸ‡µğŸ‡¹ {language.startsWith('zh') ? 'è‘¡è„ç‰™ä¹‹è·¯' : 'Portuguese Way'}</div>
                                    <div className="text-sm text-gray-600 mt-1">Porto â†’ Santiago</div>
                                </button>
                            </div>
                        </div>

                        <div className="bg-gray-50 rounded-xl p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-xl font-semibold">{t('itinerary')}ï¼ˆ{t('total')} {days.length} {t('days')}ï¼‰</h2>
                                <button onClick={autoFillDates} className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                                    {t('autoFillDates')}
                                </button>
                            </div>
                            <div className="space-y-3">
                                {days.map((day, i) => (
                                    <div key={i} className="flex gap-3 bg-white p-3 rounded-lg">
                                        <span className="text-amber-600 font-semibold w-12 pt-2">D{i + 1}</span>
                                        <input type="date" value={day.date} onChange={(e) => {
                                            const newDays = [...days];
                                            newDays[i].date = e.target.value;
                                            setDays(newDays);
                                        }} className="px-3 py-2 border rounded-lg" />
                                        <input type="text" value={day.location} onChange={(e) => {
                                            const newDays = [...days];
                                            newDays[i].location = e.target.value;
                                            setDays(newDays);
                                        }} className="flex-1 px-3 py-2 border rounded-lg" placeholder={t('locationPlaceholder')} />
                                        <button onClick={() => setDays(days.filter((_, idx) => idx !== i))} disabled={days.length === 1} className="p-2 text-red-500 hover:bg-red-50 rounded-lg disabled:opacity-30 transition">
                                            ğŸ—‘ï¸
                                        </button>
                                    </div>
                                ))}
                            </div>
                            <button onClick={() => setDays([...days, { date: '', location: '' }])} className="w-full mt-4 py-3 border-2 border-dashed border-gray-300 hover:border-amber-500 rounded-lg transition">
                                + {t('addDay')}
                            </button>
                        </div>

                        {error && (
                            <div className="mt-6 bg-red-50 border-2 border-red-300 rounded-xl p-4">
                                <div className="text-red-800">{error}</div>
                            </div>
                        )}

                        <div className="mt-6">
                            <button onClick={fetchWeather} disabled={loading} className="w-full bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold py-4 px-6 rounded-xl hover:from-amber-600 hover:to-orange-600 disabled:opacity-50 transition-all">
                                {loading ? <span className="loading-pulse">â˜ï¸ {t('querying')}</span> : `â˜ï¸ ${t('queryWeather')}`}
                            </button>
                        </div>
                    </div>

                    {weatherData && weatherData.length > 0 && (
                        <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-10">
                            {hasHistoricalData && (
                                <div className="mb-6 bg-yellow-50 border-2 border-yellow-400 rounded-xl p-4">
                                    <div className="flex items-center gap-2 text-yellow-800 font-semibold mb-2">
                                        ğŸ“Š {t('historicalDataBadge')}
                                    </div>
                                    <p className="text-yellow-700 text-sm">{t('historicalDataWarning')}</p>
                                </div>
                            )}
                            
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-3xl font-bold">{t('weatherForecast')}</h2>
                                <div className="flex gap-3">
                                    <button onClick={() => setViewMode(viewMode === 'cards' ? 'table' : 'cards')} className="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition">
                                        {viewMode === 'cards' ? t('cardView') : t('tableView')}
                                    </button>
                                    {viewMode === 'table' && (
                                        <button onClick={copyTableData} className="px-6 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 transition">
                                            {copied ? 'âœ“ ' + t('copied') : t('copyTable')}
                                        </button>
                                    )}
                                </div>
                            </div>

                            {viewMode === 'cards' ? (
                                <div className="space-y-4">
                                    {weatherData.map((day, i) => {
                                        const weekDay = t('weekdays')[new Date(day.date).getDay()];
                                        const cardClass = day.isHistorical ? 'historical-card' : 'realtime-card';
                                        
                                        return (
                                            <div key={i} className={`${cardClass} rounded-2xl shadow-lg p-6`}>
                                                <div className="flex items-center justify-between mb-4">
                                                    <div className="flex items-center gap-3">
                                                        <div className={`${day.isHistorical ? 'bg-amber-600' : 'bg-blue-600'} text-white rounded-full w-12 h-12 flex items-center justify-center font-bold`}>
                                                            D{i + 1}
                                                        </div>
                                                        <div>
                                                            <div className="text-2xl font-bold">{day.location}</div>
                                                            <div className="text-sm text-gray-600">{day.date.substring(5)} {weekDay}</div>
                                                        </div>
                                                    </div>
                                                    <div className={`px-3 py-1 rounded-full text-xs font-semibold ${day.isHistorical ? 'bg-amber-200 text-amber-800' : 'bg-blue-200 text-blue-800'}`}>
                                                        {day.isHistorical ? 'ğŸ“Š ' + t('historicalDataBadge') : 'ğŸŒ ' + t('realTimeForecast')}
                                                    </div>
                                                </div>

                                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                    <div className={`${day.isHistorical ? 'bg-amber-100' : 'bg-orange-50'} rounded-xl p-3 text-center`}>
                                                        <div className="text-3xl mb-1">â˜ï¸</div>
                                                        <div className="text-sm text-gray-600">{t('weather')}</div>
                                                        <div className="font-semibold">{day.isHistorical ? 'N/A' : day.condition}</div>
                                                    </div>
                                                    <div className={`${day.isHistorical ? 'bg-red-100' : 'bg-red-50'} rounded-xl p-3 text-center`}>
                                                        <div className="text-3xl mb-1">ğŸŒ¡ï¸</div>
                                                        <div className="text-sm text-gray-600">{t('dayTemp')}</div>
                                                        <div className="font-bold text-xl text-red-600">{convertTemp(day.dayTemp)}{tempUnit}</div>
                                                    </div>
                                                    <div className={`${day.isHistorical ? 'bg-blue-100' : 'bg-blue-50'} rounded-xl p-3 text-center`}>
                                                        <div className="text-3xl mb-1">ğŸŒ™</div>
                                                        <div className="text-sm text-gray-600">{t('nightTemp')}</div>
                                                        <div className="font-bold text-xl text-blue-600">{convertTemp(day.nightTemp)}{tempUnit}</div>
                                                    </div>
                                                    <div className={`${day.isHistorical ? 'bg-gray-100' : 'bg-cyan-50'} rounded-xl p-3 text-center`}>
                                                        <div className="text-3xl mb-1">{day.isHistorical ? 'ğŸ“Š' : 'ğŸ’§'}</div>
                                                        <div className="text-sm text-gray-600">{t('rainProb')}</div>
                                                        <div className="font-bold text-xl">{day.isHistorical ? '/' : `${day.rainChance}%`}</div>
                                                        {day.isHistorical && <div className="text-xs text-gray-500 mt-1">{t('noRainData')}</div>}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            ) : (
                                <div className="bg-gray-50 p-6 rounded-xl overflow-x-auto">
                                    <table className="w-full text-sm">
                                        <thead>
                                            <tr className="border-b-2 border-gray-300">
                                                <th className="text-left p-2">{t('itinerary')}</th>
                                                <th className="text-center p-2">{t('dayTemp')}</th>
                                                <th className="text-center p-2">{t('nightTemp')}</th>
                                                <th className="text-center p-2">{t('rainProb')}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {weatherData.map((day, i) => (
                                                <tr key={i} className={`border-b border-gray-200 ${day.isHistorical ? 'bg-yellow-50' : ''}`}>
                                                    <td className="p-2">
                                                        <div className="font-semibold">D{i+1} {day.location}</div>
                                                        <div className="text-xs text-gray-500">{day.date}</div>
                                                    </td>
                                                    <td className="text-center p-2 font-semibold text-red-600">{convertTemp(day.dayTemp)}{tempUnit}</td>
                                                    <td className="text-center p-2 font-semibold text-blue-600">{convertTemp(day.nightTemp)}{tempUnit}</td>
                                                    <td className="text-center p-2">{day.isHistorical ? '/' : `${day.rainChance}%`}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            )}

                            <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-4">
                                    <h3 className="font-semibold text-blue-800 mb-2">{t('usageTip')}</h3>
                                    <p className="text-sm text-blue-700">{t('usageTipText')}</p>
                                </div>
                                <div className="bg-amber-50 border-2 border-amber-200 rounded-xl p-4">
                                    <h3 className="font-semibold text-amber-800 mb-2">{t('notice')}</h3>
                                    <p className="text-sm text-amber-700">{t('noticeText')}</p>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="mt-8 text-center text-gray-600 text-sm">
                        <p>{t('footerText')}</p>
                        <p className="mt-2">{t('dataSource')}</p>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<CaminoWeatherApp />, document.getElementById('root'));
    </script>
</body>
</html>